<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>å¾®ä¿¡é€‰å›¾ç‰‡ç¤ºä¾‹</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
</head>
<body>
  <h2>é€‰æ‹©ä¸€å¼ å›¾ç‰‡</h2>
  <button id="chooseImageButton">é€‰å›¾</button>
  <div id="preview"></div>

  <script>
    async function getWeChatSignature() {
      const res = await fetch('https://1305432485-32szuo7mur.ap-guangzhou.tencentscf.com', { // ğŸ‘‰ åœ¨è¿™é‡Œå¡«ä¸Šä½ çš„APIåœ°å€
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url: location.href.split('#')[0] }) // å½“å‰ç½‘é¡µURL
      });
      return res.json();
    }

    getWeChatSignature().then(data => {
      wx.config({
        debug: false, // è°ƒè¯•æ¨¡å¼ï¼Œå‘å¸ƒæ—¶è¯·å…³æ‰
        appId: 'wxe946c85eaf8dcb8c', // ä½ çš„AppID
        timestamp: data.timestamp,
        nonceStr: data.nonceStr,
        signature: data.signature,
        jsApiList: ['chooseImage', 'previewImage']
      });

      wx.ready(function () {
        document.getElementById('chooseImageButton').onclick = function () {
          wx.chooseImage({
            count: 1, // åªé€‰ä¸€å¼ 
            sizeType: ['original', 'compressed'], // å¯ä»¥é€‰åŸå›¾æˆ–å‹ç¼©å›¾
            sourceType: ['album', 'camera'], // å¯ä»¥ä»ç›¸å†Œæˆ–æ‹ç…§
            success: function (res) {
              var localIds = res.localIds;
              document.getElementById('preview').innerHTML = 
                '<img src="' + localIds[0] + '" style="width: 100%; max-width: 300px;">';
            }
          });
        };
      });

      wx.error(function(err){
        console.error('å¾®ä¿¡é…ç½®é”™è¯¯:', err);
      });
    });
  </script>
</body>
</html>
